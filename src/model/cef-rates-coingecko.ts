import { createEffect, createStore, sample } from 'effector'

import { AssetsServices, ExchangeRateRaw } from '../wip/services'

// Мок-данные для CoinGecko rates
const mockAssetsRates: ExchangeRateRaw[] = [
  {
    fromAssetId: 'USDT',
    toAssetId: 'USD',
    data: {
      id: 'tether',
      symbol: 'usdt',
      name: 'Tether',
      image: 'https://assets.coingecko.com/coins/images/325/large/Tether.png',
      currentPrice: 1.0,
      marketCap: 100000000000,
      marketCapRank: 3,
      fullyDilutedValuation: 100000000000,
      totalVolume: 50000000000,
      high24h: 1.001,
      low24h: 0.999,
      priceChange24h: 0.0001,
      priceChangePercentage24h: 0.01,
      marketCapChange24h: 1000000,
      marketCapChangePercentage_24h: 0.001,
      circulatingSupply: 100000000000,
      totalSupply: 100000000000,
      maxSupply: 0,
      ath: 1.32,
      athChangePercentage: -24.24,
      athDate: '2018-07-24T00:00:00.000Z',
      atl: 0.572521,
      atlChangePercentage: 74.7,
      atlDate: '2015-03-02T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
  {
    fromAssetId: 'USDT',
    toAssetId: 'EUR',
    data: {
      id: 'tether',
      symbol: 'usdt',
      name: 'Tether',
      image: 'https://assets.coingecko.com/coins/images/325/large/Tether.png',
      currentPrice: 0.92,
      marketCap: 92000000000,
      marketCapRank: 3,
      fullyDilutedValuation: 92000000000,
      totalVolume: 46000000000,
      high24h: 0.921,
      low24h: 0.919,
      priceChange24h: 0.0001,
      priceChangePercentage24h: 0.01,
      marketCapChange24h: 920000,
      marketCapChangePercentage_24h: 0.001,
      circulatingSupply: 100000000000,
      totalSupply: 100000000000,
      maxSupply: 0,
      ath: 1.21,
      athChangePercentage: -23.97,
      athDate: '2018-07-24T00:00:00.000Z',
      atl: 0.526,
      atlChangePercentage: 74.9,
      atlDate: '2015-03-02T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
  {
    fromAssetId: 'BTC',
    toAssetId: 'USD',
    data: {
      id: 'bitcoin',
      symbol: 'btc',
      name: 'Bitcoin',
      image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png',
      currentPrice: 79968,
      marketCap: 900000000000,
      marketCapRank: 1,
      fullyDilutedValuation: 945000000000,
      totalVolume: 25000000000,
      high24h: 45500,
      low24h: 44500,
      priceChange24h: 500,
      priceChangePercentage24h: 1.12,
      marketCapChange24h: 10000000000,
      marketCapChangePercentage_24h: 1.12,
      circulatingSupply: 20000000,
      totalSupply: 21000000,
      maxSupply: 21000000,
      ath: 69045,
      athChangePercentage: -34.82,
      athDate: '2021-11-10T14:24:11.849Z',
      atl: 67.81,
      atlChangePercentage: 66264.5,
      atlDate: '2013-07-06T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
  {
    fromAssetId: 'BTC',
    toAssetId: 'EUR',
    data: {
      id: 'bitcoin',
      symbol: 'btc',
      name: 'Bitcoin',
      image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png',
      currentPrice: 79000,
      marketCap: 828000000000,
      marketCapRank: 1,
      fullyDilutedValuation: 869400000000,
      totalVolume: 23000000000,
      high24h: 41860,
      low24h: 40940,
      priceChange24h: 460,
      priceChangePercentage24h: 1.12,
      marketCapChange24h: 9200000000,
      marketCapChangePercentage_24h: 1.12,
      circulatingSupply: 20000000,
      totalSupply: 21000000,
      maxSupply: 21000000,
      ath: 63521,
      athChangePercentage: -34.82,
      athDate: '2021-11-10T14:24:11.849Z',
      atl: 62.38,
      atlChangePercentage: 66264.5,
      atlDate: '2013-07-06T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
  {
    fromAssetId: 'ETH',
    toAssetId: 'USD',
    data: {
      id: 'ethereum',
      symbol: 'eth',
      name: 'Ethereum',
      image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png',
      currentPrice: 3456.78,
      marketCap: 415000000000,
      marketCapRank: 2,
      fullyDilutedValuation: 415000000000,
      totalVolume: 15000000000,
      high24h: 3500,
      low24h: 3400,
      priceChange24h: 56.78,
      priceChangePercentage24h: 1.67,
      marketCapChange24h: 7000000000,
      marketCapChangePercentage_24h: 1.67,
      circulatingSupply: 120000000,
      totalSupply: 120000000,
      maxSupply: 0,
      ath: 4878.26,
      athChangePercentage: -29.15,
      athDate: '2021-11-10T14:24:19.604Z',
      atl: 0.432979,
      atlChangePercentage: 798225.5,
      atlDate: '2015-10-20T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
  {
    fromAssetId: 'ETH',
    toAssetId: 'EUR',
    data: {
      id: 'ethereum',
      symbol: 'eth',
      name: 'Ethereum',
      image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png',
      currentPrice: 3180.24,
      marketCap: 381600000000,
      marketCapRank: 2,
      fullyDilutedValuation: 381600000000,
      totalVolume: 13800000000,
      high24h: 3220,
      low24h: 3128,
      priceChange24h: 52.24,
      priceChangePercentage24h: 1.67,
      marketCapChange24h: 6440000000,
      marketCapChangePercentage_24h: 1.67,
      circulatingSupply: 120000000,
      totalSupply: 120000000,
      maxSupply: 0,
      ath: 4487.22,
      athChangePercentage: -29.15,
      athDate: '2021-11-10T14:24:19.604Z',
      atl: 0.398,
      atlChangePercentage: 798225.5,
      atlDate: '2015-10-20T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
  {
    fromAssetId: 'EUR',
    toAssetId: 'USD',
    data: {
      id: 'euro',
      symbol: 'eur',
      name: 'Euro',
      image: 'https://assets.coingecko.com/coins/images/14899/large/euro.png',
      currentPrice: 1.09,
      marketCap: 0,
      marketCapRank: 0,
      fullyDilutedValuation: 0,
      totalVolume: 0,
      high24h: 1.095,
      low24h: 1.085,
      priceChange24h: 0.001,
      priceChangePercentage24h: 0.09,
      marketCapChange24h: 0,
      marketCapChangePercentage_24h: 0,
      circulatingSupply: 0,
      totalSupply: 0,
      maxSupply: 0,
      ath: 1.6,
      athChangePercentage: -31.88,
      athDate: '2008-07-15T00:00:00.000Z',
      atl: 0.822,
      atlChangePercentage: 32.6,
      atlDate: '2000-10-26T00:00:00.000Z',
      lastUpdated: new Date().toISOString(),
    },
  },
]

// MOCK: Инициализация store с мок-данными
export const $assetsRates = createStore<ExchangeRateRaw[]>(mockAssetsRates)

export const assetsRatesFx = createEffect(async () => {
  return await AssetsServices.getAssetsRatesUsdEur()
})

$assetsRates.on(assetsRatesFx.doneData, (_, repos) => repos)

// MOCK: Установка мок-данных при ошибке для assetsRatesFx
sample({
  clock: assetsRatesFx.failData,
  fn: () => {
    console.error('Error fetching assets rates, using mock data')
    return mockAssetsRates
  },
  target: $assetsRates,
})
